{% extends 'base.html' %}
{% load user_filters %}
{% load thumbnail %}
{% block title%}
    <title>–ü–æ—Å—Ç {{ post.text }}</title>
{% endblock %}
{% block content%}
      <div class="row" style="margin-top:130px;">
        <aside class="col-12 col-md-3">
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: {{ post.pub_date|date:"d E Y" }}
            </li>
            <li class="list-group-item">
              –ì—Ä—É–ø–ø–∞:
            {% if post.group %}
              <a href="{% url 'posts:group_list' post.group.slug %}">
                {{ post.group }}
              </a>
            {% else %}
                –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
            {% endif %}
            </li>
            <li class="list-group-item">
              {% include 'posts/includes/author_view.html' %}
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              –í—Å–µ–≥–æ –ø–æ—Å—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∞:  <span >{{ post.author.posts.count }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              –ß–∏—Å–ª–æ –ø–æ–¥–ø–∏—Å–∏–∫–æ–≤:<span>{{ post.author.following.count }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              –ß–∏—Å–ª–æ –ø–æ–¥–ø–∏—Å–æ–∫:<span>{{ post.author.follower.count }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <a href="{% url 'posts:like' post.id %}" style="color:green">
                üëç +{{ post.like.count }}
              </a>
              <a href="{% url 'posts:dislike' post.id %}" style="color:red">
              üëé -{{ post.dislike.count }}
              </a>
            </li>
            <li class="list-group-item">
              <div class='col-'>
                <a class="btn btn-outline-primary btn-block col-12"
                  href="{% url 'posts:profile' post.author.username %}"
                  role="button">–í—Å–µ –ø–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                </a>
                {% if post.author.username == request.user.username or request.user.is_superuser %}
                <a class="btn btn-primary btn-block col-12"
                  href="{% url 'posts:post_edit' post.id %}"
                  role="button">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç
                </a>
                <button type="button" class="btn btn-danger col-12"
                  data-bs-toggle="modal" data-bs-target="#Modal">
                  –£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç
                </button>
                <div class="modal fade" id="Modal" tabindex="-1"
                       role="dialog" aria-labelledby="exampleModalLabel"
                       aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel">
                            –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
                          </h5>
                          <button type="button" class="close"
                                 data-bs-dismiss="modal" aria-label="Closes">
                          <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          –í—ã —É–≤–µ—Ä–µ–Ω—ã,—á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç?
                        </div>
                        <div class="modal-footer">
                          <a class="btn btn-danger"
                            href="{% url 'posts:post_delete' post.id %}"
                            role="button">–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç
                          </a>
                          <button type="button" class="btn btn-secondary"
                            data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                {% endif %}
              </div>
            </li>
            </ul>
          </aside>
        <article class="col-12 col-md-9">
          {% thumbnail post.image "960x500" crop="center" upscale=True as im %}
            <img class="card-img my-2" src="{{ im.url }}">
          {% endthumbnail %}
          <p>
           {{ post.text }}
          </p>
          {% if user.is_authenticated %}
          <div class="card my-4">
            <h5 class="card-header">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</h5>
            <div class="card-body" >
              <form method="post" action="{% url 'posts:add_comment' post.id %}">
              {% csrf_token %}
                <div class="form-group mb-2">
                  {{ form.text|addclass:'form-control' }}
                </div>
                <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
              </form>
            </div>
          </div>
          {% endif %}
          <div id="myform">
          {% for comment in comments %}
          {% if not comment.comment_p %}
          <div class="media mb-4">
            <div class="media-body">
              <h5 class="mt-0">
              <a href="{% url 'posts:profile' comment.author.username %}">
                {{ comment.author }}
                {% if comment.author.username == request.user.username %}
                  <span style="color:red">(–í—ã)</span>
                {% endif %}
              </a>
              </h5>
              <p style="font:menu; color:grey">
                {{ comment.created}}</p>
              <p>
              {{ comment.text|safe|linebreaksbr }}
              </p>
              <a data-bs-toggle="collapse"
                 href="#collapseComment{{comment.pk}}" aria-expanded="false"
                 aria-controls="collapseComments">
                 <span style="font:menu">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç—ã</span>
              </a>
                <a data-bs-toggle="collapse"
                   href="#collapse{{comment.pk}}" aria-expanded="false"
                   aria-controls="collapseExample">
                  <span style="font:menu">–û—Ç–≤–µ—Ç–∏—Ç—å</span>
                </a>
                <div class="collapse" id="collapse{{comment.pk}}">
                  <div class="card card-body">
                    <form method="post"
                          action="{% url 'posts:add_comment_to_comment' post.id comment.id %}">
                      {% csrf_token %}
                      <div class="form-group mb-2">
                        {{ form.text|addclass:'form-control' }}
                      </div>
                      <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    </form>
                  </div>
                </div>
                <a href="{% url 'posts:add_comment_with_quote' post.id comment.id %}">
                  <span style="font:menu">–ü—Ä–æ—Ü–∏—Ç–∏—Ä–æ–≤–∞—Ç—å</span>
                </a>
              {% if comment.author.username == request.user.username or request.user.is_superuser %}
                <a href="{% url 'posts:comment_del' post.id comment.id %}"
                style="float: right;">
                  <span style="color:red; font:menu">–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</span>
                </a>
              {% endif %}
              {% for comment_d in comments %}
              {% if comment.pk == comment_d.comment_p.id  %}
                <div class="collapse" style="padding: 5px 30px " id="collapseComment{{comment.pk}}">
                  <div class="media mb-4">
                    <div class="media-body">
                      <h5 class="mt-0">
                        <a href="{% url 'posts:profile' comment_d.author.username %}">
                          {{ comment_d.author }}
                            {% if comment.author.username == request.user.username %}
                              <span style="color:red">(–í—ã)</span>
                            {% endif %}
                        </a>
                      </h5>
                      <p style="font:menu; color:grey">
                        {{ comment_d.created}}</p>
                      <p>
                      {{ comment_d.text|safe|linebreaksbr }}
                      </p>
                      {% if comment.author.username == request.user.username or request.user.is_superuser %}
                        <a href="{% url 'posts:comment_del' post.id comment_d.id %}">
                          <span style="color:red; font:menu">–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</span>
                        </a>
                      {% endif %}
                      <hr>
                      </div>
                    </div>
                </div>
              {% endif %}
              {% endfor %}
              <hr>
            </div>
          </div>
          {% endif %}
          {% endfor %}
          </div>
        </article>
      </div>
{% endblock %}